@model Inyama_Yethu.Models.Mating

@{
    ViewData["Title"] = "Edit Mating Record";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}

<div class="container-fluid px-4">
    <h1 class="mt-4">Edit Mating Record</h1>
    <ol class="breadcrumb mb-4">
        <li class="breadcrumb-item"><a href="/Admin">Dashboard</a></li>
        <li class="breadcrumb-item"><a asp-action="Index">Breeding Records</a></li>
        <li class="breadcrumb-item active">Edit Mating Record</li>
    </ol>

    <div class="row">
        <div class="col-xl-12">
            <div class="card mb-4">
                <div class="card-header">
                    <i class="fas fa-venus-mars me-1"></i>
                    Edit Mating Record
                </div>
                <div class="card-body">
                    <form asp-action="Edit">
                        <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                        <input type="hidden" asp-for="Id" />
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for="MotherAnimalId" class="control-label fw-bold">Sow (Female)</label>
                                    <select asp-for="MotherAnimalId" class="form-control animal-select" 
                                            asp-items="@(ViewData["MotherAnimalId"] != null ? (SelectList)ViewData["MotherAnimalId"] : new SelectList(new List<SelectListItem>()))" required>
                                        <option value="">-- Select Sow --</option>
                                    </select>
                                    <span asp-validation-for="MotherAnimalId" class="text-danger"></span>
                                    <div id="motherDetails" class="small text-muted mt-1"></div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for="FatherAnimalId" class="control-label fw-bold">Boar (Male)</label>
                                    <select asp-for="FatherAnimalId" class="form-control animal-select" 
                                            asp-items="@(ViewData["FatherAnimalId"] != null ? (SelectList)ViewData["FatherAnimalId"] : new SelectList(new List<SelectListItem>()))" required>
                                        <option value="">-- Select Boar --</option>
                                    </select>
                                    <span asp-validation-for="FatherAnimalId" class="text-danger"></span>
                                    <div id="fatherDetails" class="small text-muted mt-1"></div>
                                </div>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for="MatingDate" class="control-label fw-bold">Service Date</label>
                                    <input asp-for="MatingDate" class="form-control" type="date" required />
                                    <span asp-validation-for="MatingDate" class="text-danger"></span>
                                    <small class="form-text text-muted">Date when the mating occurred</small>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for="Status" class="control-label fw-bold">Status</label>
                                    <select asp-for="Status" class="form-control" required>
                                        <option value="Scheduled">Scheduled</option>
                                        <option value="Pending">Pending</option>
                                        <option value="PregnancyConfirmed">Pregnancy Confirmed</option>
                                        <option value="NotPregnant">Not Pregnant</option>
                                        <option value="Farrowed">Farrowed</option>
                                    </select>
                                    <span asp-validation-for="Status" class="text-danger"></span>
                                </div>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for="ExpectedPregnancyCheck1" class="control-label fw-bold">First Expected Pregnancy Check</label>
                                    <input asp-for="ExpectedPregnancyCheck1" class="form-control" type="date" />
                                    <span asp-validation-for="ExpectedPregnancyCheck1" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for="PregnancyCheck1Result" class="control-label fw-bold">First Pregnancy Check Result</label>
                                    <select asp-for="PregnancyCheck1Result" class="form-control">
                                        <option value="">Not Checked</option>
                                        <option value="True">Positive</option>
                                        <option value="False">Negative</option>
                                    </select>
                                    <span asp-validation-for="PregnancyCheck1Result" class="text-danger"></span>
                                </div>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for="ExpectedPregnancyCheck2" class="control-label fw-bold">Second Expected Pregnancy Check</label>
                                    <input asp-for="ExpectedPregnancyCheck2" class="form-control" type="date" />
                                    <span asp-validation-for="ExpectedPregnancyCheck2" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for="PregnancyCheck2Result" class="control-label fw-bold">Second Pregnancy Check Result</label>
                                    <select asp-for="PregnancyCheck2Result" class="form-control">
                                        <option value="">Not Checked</option>
                                        <option value="True">Positive</option>
                                        <option value="False">Negative</option>
                                    </select>
                                    <span asp-validation-for="PregnancyCheck2Result" class="text-danger"></span>
                                </div>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for="ExpectedFarrowingDate" class="control-label fw-bold">Expected Farrowing Date</label>
                                    <input asp-for="ExpectedFarrowingDate" class="form-control" type="date" />
                                    <span asp-validation-for="ExpectedFarrowingDate" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for="ActualFarrowingDate" class="control-label fw-bold">Actual Farrowing Date</label>
                                    <input asp-for="ActualFarrowingDate" class="form-control" type="date" />
                                    <span asp-validation-for="ActualFarrowingDate" class="text-danger"></span>
                                </div>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for="NumberOfPigletsBorn" class="control-label fw-bold">Total Piglets Born</label>
                                    <input asp-for="NumberOfPigletsBorn" class="form-control" type="number" min="0" />
                                    <span asp-validation-for="NumberOfPigletsBorn" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for="NumberOfPigletsBornAlive" class="control-label fw-bold">Piglets Born Alive</label>
                                    <input asp-for="NumberOfPigletsBornAlive" class="form-control" type="number" min="0" />
                                    <span asp-validation-for="NumberOfPigletsBornAlive" class="text-danger"></span>
                                </div>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for="ExpectedVaccinationDate1" class="control-label fw-bold">First Vaccination Date</label>
                                    <input asp-for="ExpectedVaccinationDate1" class="form-control" type="date" />
                                    <span asp-validation-for="ExpectedVaccinationDate1" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for="Vaccination1Completed" class="control-label fw-bold">First Vaccination Completed</label>
                                    <select asp-for="Vaccination1Completed" class="form-control">
                                        <option value="False">No</option>
                                        <option value="True">Yes</option>
                                    </select>
                                    <span asp-validation-for="Vaccination1Completed" class="text-danger"></span>
                                </div>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for="ExpectedVaccinationDate2" class="control-label fw-bold">Second Vaccination Date</label>
                                    <input asp-for="ExpectedVaccinationDate2" class="form-control" type="date" />
                                    <span asp-validation-for="ExpectedVaccinationDate2" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for="Vaccination2Completed" class="control-label fw-bold">Second Vaccination Completed</label>
                                    <select asp-for="Vaccination2Completed" class="form-control">
                                        <option value="False">No</option>
                                        <option value="True">Yes</option>
                                    </select>
                                    <span asp-validation-for="Vaccination2Completed" class="text-danger"></span>
                                </div>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label asp-for="Notes" class="control-label fw-bold">Notes</label>
                                    <textarea asp-for="Notes" class="form-control" rows="3" placeholder="Enter any relevant notes about this mating..."></textarea>
                                    <span asp-validation-for="Notes" class="text-danger"></span>
                                </div>
                            </div>
                        </div>

                        <div class="form-group mt-4 d-flex justify-content-between">
                            <a asp-action="Index" class="btn btn-outline-secondary">
                                <i class="fas fa-arrow-left me-1"></i> Back to List
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-1"></i> Save Changes
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script>
        $(document).ready(function() {
            // Initialize Select2 for better dropdown experience if available
            if ($.fn.select2) {
                $('.animal-select').select2({
                    theme: 'bootstrap4',
                    placeholder: 'Select animal',
                    allowClear: true
                });
            }
            
            // Load animal details when selection changes
            $("#MotherAnimalId").on("change", function() {
                var motherId = $(this).val();
                if (motherId) {
                    // This would typically be an AJAX call to get animal details
                    // For demonstration, we'll just show a placeholder
                    $("#motherDetails").html("Loading sow details...");
                    
                    // Simulated AJAX response
                    setTimeout(function() {
                        $("#motherDetails").html("Sow ID: " + motherId + " - Parity: 2 - Last farrowing: 120 days ago");
                    }, 500);
                } else {
                    $("#motherDetails").html("");
                }
            });
            
            $("#FatherAnimalId").on("change", function() {
                var fatherId = $(this).val();
                if (fatherId) {
                    // This would typically be an AJAX call to get animal details
                    $("#fatherDetails").html("Loading boar details...");
                    
                    // Simulated AJAX response
                    setTimeout(function() {
                        $("#fatherDetails").html("Boar ID: " + fatherId + " - Age: 18 months - Last service: 14 days ago");
                    }, 500);
                } else {
                    $("#fatherDetails").html("");
                }
            });
            
            // Trigger the event on page load if value exists
            if ($("#MotherAnimalId").val()) {
                $("#MotherAnimalId").trigger("change");
            }
            
            if ($("#FatherAnimalId").val()) {
                $("#FatherAnimalId").trigger("change");
            }
        });
    </script>
} 